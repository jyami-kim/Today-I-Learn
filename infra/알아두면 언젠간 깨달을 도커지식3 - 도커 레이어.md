# 알아두면 언젠간 깨닫는 도커지식 3

### 도커 스웜

도커 클러스터 : 도커 엔진이 설치된 여러개의 서버를 묶는다.

컨테이너 생명주기 관리도 해주고, 자원 할당도 적재적소에 해준다.

쿠버네티스와의 차이는 오토스케일링이다. 스웜에서 오토스케일링을 하려면 직접 구축을 해야한다.  



> 이 아래 글은 어디 둬야할지 모르겠어서 일단 추가ㅋ

### 도커의 재밌는 점 : 도커 레이어

도커는 레이어 방식이다

도커 파일의 명령어 한줄 한줄이 레이어로 만들어지고, 명령어를 추가한다는 것은 그 레이어를 쌓아올리는 형식이다. (~~git commit이랑 비슷한 느낌이 있는듯?~~)

레이어를 쌓아올린다는 것은 앞에 레이어와의 **차이점**만을 기록한다는 것이다.

그래서 깃 플로우 작성하듯이 도커 레이어를 중간에 잘라서 사용도 가능하다.
도커 파일에 앞 내용이 중복되고, 브랜치 딴 것 같은 모양새의 레이어라면 캐시된 내용을 불러와서 빌드한다 (레이어 캐싱)

예를들어

1번 도커파일

```
1
2
3
4
5
```

2번 도커파일

```
1
2
3
4-2
5-2
```

두 도커파일의 내용이 있다면 3까지는 중복이니까, 이미 만들어 둔 레이어를 불러와서 4-2부터 작업한다(빌드한다)

따라서 이미 캐싱이 되어있고 커맨드가 일치하면 작업 결과도 같을꺼라고 예상하는 것이다 도커의 빠른 빌드에 **레이어 캐싱** 기술이 숨어져 있었던 것!!



> 그래서 난 이전에 캐싱 된 내용이 아예 잘못 되서, 빌드도 계속 실패하는 경우가 있었다. (원인을 몰랐었음..)
>
> 그래서 도커를 빌드할 때 캐싱에 유의해야 하며, 에러가 의심될 경우엔 아래 명령어를 입력한다.
>
> ```shell
> docker build --no-cache -t [이미지명]:[태크명] .
> ```

