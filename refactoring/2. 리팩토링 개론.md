# Chapter2. 리팩토링 개론

### 리팩토링이란

##### 리팩토링 뜻

리팩토링(명사) : 겉으로 드러나는 기능은 그대로 둔 채, **알아보기 쉽고 수정하기 간편하게 소프트웨어 내부를 수정**하는 작업

리팩토링(동사) : 리팩토링 기법을 연달아 적용해서 겉으로 드러나는 기능은 그대로 둔 채 **소프트웨어 구조를 변경**한다

##### 리팩토링의 목적

-  소프트웨어를 더 이해하기 쉽고 수정하기 쉽게 만드는 것
- 리팩토링은 겉으로 드러나는 소프트웨어 기능에 영향을 주지 않는다.



#### 두가지 모자

리팩토링을 할 때는 코드 구조 개선만 해야한다. 

기능을 추가하거나 리팩토링 (코드 구조 개선) 과정만 해야한다. 두가지 작업이 섞이지 않도록 일에 일관성을 가져야 한다.



### 리팩토링은 왜 해야 하나

1. 소프트웨어 설계가 개선되니까
   코드를 수정하면 코드 정리가 되면서 깔끔한 설계를 할 수 있어진다.
2. 소프트웨어를 이해하기가 더 쉬워지니까
   프로그래밍에서 중요한거 의도한 바를 정확히 전달하는 것이다. > 의도한 바를 잘 알 수 있어야한다
3. 버그를 찾기가 쉬워지니까
   코드를 파악하기 쉬우면 버그 발견도 쉬워진다.
4. 프로그래밍 속도가 빨라지니까
   버그찾기에 많은 시간을 낭비하지 않고, 시스템을 이해하고 중복 코드를 찾아내느라 수정시간이 길어지는 상황을 방지할 수 있다.



### 리팩토링은 어떨 때 필요한가

1. 같은 작업의 삼진 아웃 때
   같은 작업을 3번째 반복하게 됐을 대 리팩토링을 실시하자
2. 기능을 추가할 때
   이 코드를 이런식으로 설계했다면 이 기능을 추가하기 쉬웠을 텐데 생각이 들었을 때
3. 버그를 수정할 때
   버그 리포트를 받을 정도면 버그가 있는줄도 모를 만큼 그 코드가 더러울 것
4. 코드를 검수할 때
   명료한 코드를 작성하기 위해서도 꼭 필요하다.



### 리팩토링의 효용성

프로그램이 수정이 힘들어지는 4가지 경우

- 코드를 알아보기 힘들 때
- 중복된 로직이 들어 있을 때
- 추가 기능을 넣어야 해서 실행 중인 코드를 변경해야 할 때
- 조건문 구조가 복잡할 때



### 인다이렉션과 리팩토링

인다이렉션을 사용하는 것은 가능한 자제하는 것이 좋다. (객체가 계속해서 다른 객체에 작업을 위임할 수 있기 때문에)

인다이렉션의 장점

- 로직을 공유
- 의도와 구현부를 따로 나타냄
- 수정 부분을 분리
- 조건문을 코드화



### 리팩토링 관련 문제들

1. 데이터 베이스

   수 많은 비즈니스 애플리케이션은 바탕이 되는 데이터베이스 스키마와 강력히 결합되어있음
   => 객체 모델과 데이터베이스 모델 사이에 별도의 소프트웨어 계층을 두는 방법이 있음

2. 인터페이스 변경

   객체의 장점 인터페이스를 건드리지 않고 내부 구현 코드를 수정할 수 있음.
   그러나 리팩토링 자체가 인터페이스를 수정하는 작업이다. > 인터페이스가 사용되는 부분을 찾는 게 불가능하거나 수정할 수 없을 경우엔 문제가 생긴다.

   인터페이스를 함부로 배포(published) 타입으로 만들지 말자. 팀원 간의 트러블이 생기지 않는 융통성 있는 리팩토링을 위해 코드 소유권 정책을 수정하자.

3. 리팩토링을 어렵게 하는 설계를 수정하는 일

   설계 자체에 대한 오류, 설계에 대한 의사결정이 바뀌었을때, 수정하기 힘들 것 같을때
   => 모두 리팩토링으로 해결할 수 있다.

4. 리팩토링하면 안 되는 상황

   코드를 처음부터 새로 작성해야할 때 > 만약 돌아가지 않으면 새로 작성해야한다.
   납기가 임박했을 때도 리팩토링은 삼가해야한다.



### 리팩토링과 설계

설계 = 기술 도면 
코드 = 건설 작업

나중에 수정할 필요가 없도록 사전 설계에 더 많은 시간과 큰 노력을 들여야 한다.

사전 설계 없이 리팩토링만 해도 되지만 좋은 방법은 아니다.



### 리팩토링과 성능

빠른 소프트웨어를 작성할 수 있는 방법

- 철저한 실시간 시스템에 주로 사용되는 시간 분배 : 설계를 분배하면서 각 구성 요소에 ㅅ기간이나 메모리 사용량 같은 자원별 예산을 할당 하는 것.
- 성능에 꾸준한 관심을 갖는 것 : 성능 향상 프로그램 코드가 여기저기 널리게되고, 각 부분의 향상은 프로그램 기능에 국한된다.
- 1,2 번의 90% 방법만 활용한다. 최적화 전까지는 성능에 신경 쓰지 않고 프로그램을 잘 쪼개진 방식으로 제작한다. (작은 노력으로 큰 효과)

