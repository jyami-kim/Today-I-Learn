# Chapter9. 도메인 모델과 BOUNDED CONTEXT

### 도메인 모델과 경계

처음 도메인 모델을 만들때: 도메인을 완벽하게 표현하는 단일 모델을 만드는 시도를 하는 것.
=> 도메인은 여러 하위 도메인으로 구분되기 때문에 한 개의 모델로 여러 하위 도메인을 모두 표현하려고 시도하면 모든 하위 도메인에 맞지 않는 모델을 만들게 된다.

BOUNDED_CONTEXT : 구분 되는 경계를 갖는 컨텍스트

> 모델은 특정한 컨텍스트하에서 완전한 의미를 갖는다. 같은 제품이라도 카탈로그 컨텍스트와 재고 컨텍스트에서 의미가 서로 다르다.



### BOUNDED CONTEXT

모델의 경계를 결정하며 한 개의 BOUNDED CONTEXT는 논리적으로 한개의 모델을 갖는다.

여러 하위 도메인을 하나의 BOUNDED CONTEXT에서 개발할 때 주의점은 하위 도메인의 모델이 뒤섞이지 않도록 하는 것. 

- 도메인 모델이 개별 하위 도메인을 제대로 반영하지 못함
- 한개의 BOUNDED CONTEXT에서 여러 하위 도메인을 포함해도 하위 도메인마다 구분되는 패키지를 갖도록 구현해야함. (서로 뒤섞이지 않음.) : 패키지로 논리적 분리

도메인 모델을 구분하는 경계



### BOUNDED CONTEXT의 구현

도메인 모델만 포함하는 것은 아니다. 

도메인 기능을 사용자에게 제공하는 데 필요한 표현 영역, 응용 서비스, 인프라 영역 등을 모두 포함한다.

모든 BOUNDED CONTEXT를 반드시 도메인 주도로 개발할 필요는 없다.

한개의 BOUNDED CONTEXT에서 두 방식을 혼합해서 사용할 수도 있다

- CQRS = Command Query Responsibility Segregation : 상태를 변경하는 명령 기능과 내용을 조회하는 쿼리 기능을 위한 모델을 구분하는 패턴

파사드(Faced) 역할 : 브라우저가 UI 서버에 요청을 보내면, UI 서버는 카탈로그와 리뷰 BOUNDED CONTEXT로부터 필요한 정보를 읽어와 조합한 뒤 브라우저에 응답을 제공한다.



### BOUNDED CONTEXT간 통합

두 팀이 관련된 BOUNDED CONTEXT를 개발하면 자연스럽게 두 BOUNDED CONTEXT간 통합이 발생한다.

외부연동을 위한 도메인 서비스 구현 클래스는 도메인 모델과 외부 시스템 간의 모델 변환을 처리한다.

- domain > 도메인 관점에서 인터페이스 정의 (ProductionRecommendationService)
- infra > 도메인 모델과 외부 시스템 간의 모델 변환 처리(RecSystemClient)
- 외부 > 외부 추천 시스템 : REST API

REST API : 직접 통합 / 메시징 큐 : 간접 통합

큐를 누가 제공하느냐에 따라 데이터 구조가 결정된다 : 이 방식은 한쪽에서 메시지를 출판하고 다른 쪽에서 메시지를 구독하는 출판/구독 모델을 따른다



### BONDED CONTEXT 간 관계

두개의 BOUNDED CONTEXT 간 관계 중 가장 흔한 관계는 한쪽에서 API를 제공하고 다른 한쪽에서 그 API를 호출하는 관계이다.

- 상류 컴포넌트 : 일종의 서비스 공급자 역할
- 하류 컴포넌트 : 그 서비스를 사용하는 고객 역할

공급자 역할을 하는 상류에서 마음대로 API를 변경하면 하류팀은 변경된 API에 맞추느라 다른 개발을 못할 수도 있다.

공개 호스트 서비스(OPEN HOST SERVICE) : 대표적으로 검색서비스 

> 각 서비스별로 검색 기능 구현 X : 검색을 위한 전용 시스템을 구축하고 검색 시스템과 각 서비스를 통합

하류컴포넌트는 상류 서비스의 모델이 자신의 도메인 모델에 영향을 주지 않도록 보호해주는 **완충 지대**를 만들어야한다. - anticorruption layer

두 팀이 공유하는 모델 (shared Kernel)을 공유 커널이라고 부른다. > 중복을 줄여준다.

독립 방식 (SEPARATE WAY) 관계 : 서로 통합하지 않는 방식. 통합을 하지 않아 서로 독립적으로 모델을 발전시킨다.

두 BOUNDED CONTEXT 간의 통합은 수동으로 이루어 진다. > 규모가 커질수록 수동 통합에는 한계가 있어 두 BOUNDED CONTEXT를 통합해야한다.



### 컨텍스트 맵

개별에 매몰되면 전체를 보지 못할 때가 있다.

컨텍스트 맵 : BOUNDED CONTEXT 간의 관계를 표시한 것. - 시스템의 전체 구조를 보여준다.

- 전체 시스템의 이해 수준을 보여준다.
- 시스템을 더 잘 이해하거나 시간이 지나면서 컨텍스트 간 관계가 바뀌면 컨텍스트 맵도 함께 바뀐다.

